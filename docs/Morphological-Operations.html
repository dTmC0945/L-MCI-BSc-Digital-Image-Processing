<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Code for Digital Image Processing Morphological Operations</title>
<meta name="author" content="Daniel McGuiness" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" href="config/style.css">
<script type="text/javascript"  src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="config/test.js">
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
// @license-end
</script>

<script>
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
org_html_manager.set("TOC_DEPTH", "3");
org_html_manager.set("LINK_HOME", "");
org_html_manager.set("LINK_UP", "index.html");
org_html_manager.set("LOCAL_TOC", "1");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "underline");
org_html_manager.set("FIXED_TOC", "0");
org_html_manager.set("TOC", "1");
org_html_manager.set("VIEW", "info");
org_html_manager.setup();  // activate after the parameters are set
// @license-end
</script>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="index.html"> UP </a>
 |
 <a accesskey="H" href=""> HOME </a>
</div><div id="content" class="content">
<h1 class="title">Code for Digital Image Processing Morphological Operations</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgb4b4e50">Introduction</a>
<ul>
<li><a href="#orga53cc76">Preamble</a></li>
<li><a href="#org153cd51">Erosion</a>
<ul>
<li><a href="#org10f3eba">Plotting Comparisons</a></li>
</ul>
</li>
<li><a href="#orgb597d92">Dilation</a></li>
<li><a href="#org18724db">Opening</a></li>
<li><a href="#org80fa906">Closing</a></li>
<li><a href="#org13e9d8f">Gradient</a></li>
<li><a href="#org9ad930f">Tophat</a>
<ul>
<li><a href="#orga357ae8">White Top-hat</a></li>
<li><a href="#org4071603">Blackhat</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org5e37787">Application: Morphological Filtering</a>
<ul>
<li><a href="#orgcdb311c">Erosion</a></li>
</ul>
</li>
<li><a href="#orgc2d9151">Application: Filtering Maps for Logistic Mapping</a></li>
<li><a href="#org53f0efe">Application: Measure fluorescence intensity at the nuclear envelope</a>
<ul>
<li><a href="#org7ac20ae">Segment the Nucleus Rim</a></li>
<li><a href="#org2368066">Apply Segmented Rim as a Mask</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
These are the code snippets used in <code>Morphological Operations</code>
part of <code>Digital Image Processing</code>.
</p>

<div id="outline-container-orgb4b4e50" class="outline-2">
<h2 id="orgb4b4e50">Introduction</h2>
<div class="outline-text-2" id="text-orgb4b4e50">
</div>
<div id="outline-container-orga53cc76" class="outline-3">
<h3 id="orga53cc76">Preamble</h3>
<div class="outline-text-3" id="text-orga53cc76">
<p>
The following is a custom package written to handle plotting
and other functions required by the lecture.
</p>

<div class="org-src-container">
<pre class="src src-python" id="org76caa9e"><span class="org-keyword">import</span> matplotlib.pyplot <span class="org-keyword">as</span> plt
<span class="org-keyword">import</span> cv2 <span class="org-keyword">as</span> cv
<span class="org-keyword">import</span> ChalcedonPy <span class="org-keyword">as</span> cp

<span class="org-comment-delimiter"># </span><span class="org-comment">Initialise ChalcedonPy</span>
cp.init<span class="org-rainbow-delimiters-depth-1">(</span>save_path<span class="org-operator">=</span><span class="org-string">"Morphological-Operations"</span>,
        display_mode<span class="org-operator">=</span><span class="org-string">"slide"</span><span class="org-rainbow-delimiters-depth-1">)</span> 
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org62f4197"><span class="org-keyword">import</span> matplotlib.colors  <span class="org-comment-delimiter"># </span><span class="org-comment">all related to colours</span>
<span class="org-keyword">from</span> matplotlib.image <span class="org-keyword">import</span> imread
<span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np
<span class="org-keyword">from</span> skimage <span class="org-keyword">import</span> data, io, color, morphology
<span class="org-keyword">import</span> skimage <span class="org-keyword">as</span> sk
</pre>
</div>
</div>
</div>

<div id="outline-container-org153cd51" class="outline-3">
<h3 id="org153cd51">Erosion</h3>
<div class="outline-text-3" id="text-org153cd51">
<p>
Erosion is used to remove pixels from the boundary
of the input image shrinking the object.
</p>

<p>
To make publishing and generating images easier a custom wrapper function
is defined with the following defition and parameters.
</p>

<p>
<code>DEFINITION:</code> Apply the erosion morphology process to an image
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="all" frame="border" width="100%">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">PARAMETER</th>
<th scope="col" class="org-left">FUNCTION</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">iterations</td>
<td class="org-left">number of times erosion is applied</td>
</tr>

<tr>
<td class="org-left">show</td>
<td class="org-left">Presents the comparative image to the user.</td>
</tr>

<tr>
<td class="org-left">publish</td>
<td class="org-left">Prints the image with the name being the entered value (300 dpi, .png)</td>
</tr>

<tr>
<td class="org-left">rgb</td>
<td class="org-left">Converts images from bgr to rgb.</td>
</tr>

<tr>
<td class="org-left">return</td>
<td class="org-left">Returns original image and the filtered image.</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-python" id="org7be6fc8"><span class="org-keyword">def</span> <span class="org-function-name">morph_erosion</span><span class="org-rainbow-delimiters-depth-1">(</span>image, kernel, iterations<span class="org-operator">=</span>1, show<span class="org-operator">=</span><span class="org-constant">None</span>, publish<span class="org-operator">=</span><span class="org-constant">None</span>, rgb<span class="org-operator">=</span><span class="org-constant">None</span><span class="org-rainbow-delimiters-depth-1">)</span>:
    <span class="org-variable-name">erosion</span> <span class="org-operator">=</span> cv.erode<span class="org-rainbow-delimiters-depth-1">(</span>cv.imread<span class="org-rainbow-delimiters-depth-2">(</span>image<span class="org-rainbow-delimiters-depth-2">)</span>, kernel, iterations<span class="org-operator">=</span>iterations<span class="org-rainbow-delimiters-depth-1">)</span>

    cp.Plotting.image_subplot_style<span class="org-rainbow-delimiters-depth-1">(</span>1, 2, image_array<span class="org-operator">=</span><span class="org-rainbow-delimiters-depth-2">[</span>cv.imread<span class="org-rainbow-delimiters-depth-3">(</span>image<span class="org-rainbow-delimiters-depth-3">)</span>, erosion<span class="org-rainbow-delimiters-depth-2">]</span>,
                                    show<span class="org-operator">=</span>show,
                                    publish<span class="org-operator">=</span>publish,
                                    rgb<span class="org-operator">=</span>rgb<span class="org-rainbow-delimiters-depth-1">)</span>

    <span class="org-keyword">return</span> cv.imread<span class="org-rainbow-delimiters-depth-1">(</span>image<span class="org-rainbow-delimiters-depth-1">)</span>, erosion
</pre>
</div>
</div>

<div id="outline-container-org10f3eba" class="outline-4">
<h4 id="org10f3eba">Plotting Comparisons</h4>
<div class="outline-text-4" id="text-org10f3eba">
<p>
The following are successive effects of increasing the kernel size.
The kernel size is made up from 1's using a <code>numpy</code> array.
</p>

<p>
The following comparison is between the original and the original
with erosion applied with a kernel size of 5.
</p>

<div class="org-src-container">
<pre class="src src-python" id="org4fcafc2"><span class="org-keyword">import</span> matplotlib.cm <span class="org-keyword">as</span> cm

<span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>5<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> data.camera<span class="org-rainbow-delimiters-depth-1">()</span>

fig, <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">ax1</span>, <span class="org-variable-name">ax2</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-operator">=</span> plt.subplots<span class="org-rainbow-delimiters-depth-1">(</span>1, 2<span class="org-rainbow-delimiters-depth-1">)</span>
ax1.grid<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">False</span><span class="org-rainbow-delimiters-depth-1">)</span>; ax1.minorticks_off<span class="org-rainbow-delimiters-depth-1">()</span>; ax1.set_xticks<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">[]</span><span class="org-rainbow-delimiters-depth-1">)</span>; ax1.set_yticks<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">[]</span><span class="org-rainbow-delimiters-depth-1">)</span>
ax1.imshow<span class="org-rainbow-delimiters-depth-1">(</span>image, cmap<span class="org-operator">=</span>cm.gray<span class="org-rainbow-delimiters-depth-1">)</span>
ax2.grid<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">False</span><span class="org-rainbow-delimiters-depth-1">)</span>; ax2.minorticks_off<span class="org-rainbow-delimiters-depth-1">()</span>; ax2.set_xticks<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">[]</span><span class="org-rainbow-delimiters-depth-1">)</span>; ax2.set_yticks<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">[]</span><span class="org-rainbow-delimiters-depth-1">)</span>
ax2.imshow<span class="org-rainbow-delimiters-depth-1">(</span>sk.morphology.erosion<span class="org-rainbow-delimiters-depth-2">(</span>image, kernel<span class="org-rainbow-delimiters-depth-2">)</span>, cmap<span class="org-operator">=</span>cm.gray<span class="org-rainbow-delimiters-depth-1">)</span>
ax1.set_xlabel<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'(a)'</span>, labelpad<span class="org-operator">=</span>10<span class="org-rainbow-delimiters-depth-1">)</span>
ax2.set_xlabel<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'(b)'</span>, labelpad<span class="org-operator">=</span>10<span class="org-rainbow-delimiters-depth-1">)</span>
plt.tight_layout<span class="org-rainbow-delimiters-depth-1">()</span>
plt.grid<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-constant">False</span><span class="org-rainbow-delimiters-depth-1">)</span>
plt.savefig<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"images/Morphological-Operations/erosion-k-5.pdf"</span>, bbox_inches<span class="org-operator">=</span><span class="org-string">'tight'</span><span class="org-rainbow-delimiters-depth-1">)</span>
plt.show<span class="org-rainbow-delimiters-depth-1">()</span>
</pre>
</div>


<div id="org8517a0d" class="figure">
<p><img src="images/Morphological-Operations/Erosion-k-5.png" alt="Erosion-k-5.png" />
</p>
</div>

<p>
As can be seen there is a slight different between the two images as the one on the right seems to
have lost its shapness.
</p>

<p>
The following comparison is between the original and the original with erosion
applied with a kernel size of 9.
</p>

<div class="org-src-container">
<pre class="src src-python" id="orgef23c06"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>9<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">er</span> <span class="org-operator">=</span> morph_erosion<span class="org-rainbow-delimiters-depth-1">(</span>image,
                      kernel,
                      publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/Erosion-k-9"</span>,
                      show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="org6c97ff5" class="figure">
<p><img src="images/Morphological-Operations/Erosion-k-9.png" alt="Erosion-k-9.png" />
</p>
</div>

<p>
The image on the right seems to be darker on the edges.
The following comparison is between the original and the original with erosion
applied with a kernel size of 13.
</p>

<div class="org-src-container">
<pre class="src src-python" id="org584de18"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>13<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">er</span> <span class="org-operator">=</span> morph_erosion<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                      publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/Erosion-k-13"</span>,
                      show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="orgd384f5c" class="figure">
<p><img src="images/Morphological-Operations/Erosion-k-13.png" alt="Erosion-k-13.png" />
</p>
</div>

<p>
The darkness has increased with the ediges becoming ever more shifted.
</p>

<p>
The following comparison is between the original and the original with erosion
applied with a kernel size of 17.
</p>

<div class="org-src-container">
<pre class="src src-python" id="org83d1bd2"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>17<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">er</span> <span class="org-operator">=</span> morph_erosion<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                      publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/Erosion-k-17"</span>,
                      show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="org5f3e3d4" class="figure">
<p><img src="images/Morphological-Operations/Erosion-k-17.png" alt="Erosion-k-17.png" />
</p>
</div>

<p>
The following comparison is between the original and the original with erosion
applied with a kernel size of 21.
</p>

<div class="org-src-container">
<pre class="src src-python" id="org9c55a82"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>21<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">er</span> <span class="org-operator">=</span> morph_erosion<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                      publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/Erosion-k-21"</span>,
                      show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="org081e85b" class="figure">
<p><img src="images/Morphological-Operations/Erosion-k-21.png" alt="Erosion-k-21.png" />
</p>
</div>

<p>
Compared to the original the image has completely lost its sharpness and it looks as if someone
slightly smeared it going up.
</p>

<p>
Here, lets compare erosion with increasing kernel sizes in one big
image, along with the original, for a better comparison.
</p>

<div class="org-src-container">
<pre class="src src-python" id="org79dd1f4"><span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_5</span> <span class="org-operator">=</span> morph_erosion<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>5<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_9</span> <span class="org-operator">=</span> morph_erosion<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>9<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_13</span> <span class="org-operator">=</span> morph_erosion<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>13<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_17</span> <span class="org-operator">=</span> morph_erosion<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>17<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_21</span> <span class="org-operator">=</span> morph_erosion<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>21<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-variable-name">image_array</span><span class="org-operator">=</span><span class="org-rainbow-delimiters-depth-1">[</span>o, me_5, me_9, me_13, me_17, me_21<span class="org-rainbow-delimiters-depth-1">]</span>

Plotting.image_subplot_style<span class="org-rainbow-delimiters-depth-1">(</span>2, 3, image_array<span class="org-operator">=</span>image_array,
    show<span class="org-operator">=</span><span class="org-constant">False</span>,
    publish<span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/Erosion-comparison"</span>,
    rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>

</pre>
</div>


<div id="org77fa27a" class="figure">
<p><img src="images/Morphological-Operations/Erosion-comparison.png" alt="Erosion-comparison.png" />
</p>
</div>

<p>
In the above image, <span class="Hlight">(a)</span> is the original input (b) is eroded with kernel
size 5, (c) is 9, (d) is 13 (e) is 17, and (f) is 21.
</p>
</div>
</div>
</div>

<div id="outline-container-orgb597d92" class="outline-3">
<h3 id="orgb597d92">Dilation</h3>
<div class="outline-text-3" id="text-orgb597d92">
<p>
Dilation is one of the most common morphological operation
along with Erosion where it is used to add pixels to the
boundary of the input image making the object more visible
and fill small voids in the image.
</p>

<p>
Dilation operator takes two inputs, one is the image
and the other one is the structuring element (i.e., kernel).
</p>

<p>
The structuring element determines the effect of dilation
on the input image.
</p>

<div class="org-src-container">
<pre class="src src-python" id="orgc4fdfc5"><span class="org-keyword">def</span> <span class="org-function-name">morph_dilation</span><span class="org-rainbow-delimiters-depth-1">(</span>image, kernel, iterations<span class="org-operator">=</span>1, show<span class="org-operator">=</span><span class="org-constant">None</span>, publish<span class="org-operator">=</span><span class="org-constant">None</span>, rgb<span class="org-operator">=</span><span class="org-constant">None</span><span class="org-rainbow-delimiters-depth-1">)</span>:
    <span class="org-variable-name">dilation</span> <span class="org-operator">=</span> cv.dilate<span class="org-rainbow-delimiters-depth-1">(</span>cv.imread<span class="org-rainbow-delimiters-depth-2">(</span>image<span class="org-rainbow-delimiters-depth-2">)</span>, kernel, iterations<span class="org-operator">=</span>iterations<span class="org-rainbow-delimiters-depth-1">)</span>

    Plotting.image_subplot_style<span class="org-rainbow-delimiters-depth-1">(</span>1, 2, image_array<span class="org-operator">=</span><span class="org-rainbow-delimiters-depth-2">[</span>cv.imread<span class="org-rainbow-delimiters-depth-3">(</span>image<span class="org-rainbow-delimiters-depth-3">)</span>, dilation<span class="org-rainbow-delimiters-depth-2">]</span>,
                                 show<span class="org-operator">=</span>show,
                                 publish<span class="org-operator">=</span>publish,
                                 rgb<span class="org-operator">=</span>rgb<span class="org-rainbow-delimiters-depth-1">)</span>

    <span class="org-keyword">return</span> cv.imread<span class="org-rainbow-delimiters-depth-1">(</span>image<span class="org-rainbow-delimiters-depth-1">)</span>, dilation
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org2c73e57"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>5<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_dilation<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                      publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/dilation-k-5"</span>,
                      show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="org317014a" class="figure">
<p><img src="images/Morphological-Operations/dilation-k-5.png" alt="dilation-k-5.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org8aa8904"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>9<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_dilation<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                      publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/dilation-k-9"</span>,
                      show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="org8c61098" class="figure">
<p><img src="images/Morphological-Operations/dilation-k-9.png" alt="dilation-k-9.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org4911a33"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>13<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_dilation<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                      publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/dilation-k-13"</span>,
                      show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="orge8fe84d" class="figure">
<p><img src="images/Morphological-Operations/dilation-k-13.png" alt="dilation-k-13.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="orgfaef247"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>17<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_dilation<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/dilation-k-17"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="orge649419" class="figure">
<p><img src="images/Morphological-Operations/dilation-k-17.png" alt="dilation-k-17.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org3f721bb"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>21<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_dilation<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                      publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/dilation-k-21"</span>,
                      show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="orgbc3d7db" class="figure">
<p><img src="images/Morphological-Operations/dilation-k-21.png" alt="dilation-k-21.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="orgfd1dbe7"><span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_5</span> <span class="org-operator">=</span> morph_dilation<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>5<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_9</span> <span class="org-operator">=</span> morph_dilation<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>9<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_13</span> <span class="org-operator">=</span> morph_dilation<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>13<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_17</span> <span class="org-operator">=</span> morph_dilation<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>17<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_21</span> <span class="org-operator">=</span> morph_dilation<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>21<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-variable-name">image_array</span><span class="org-operator">=</span><span class="org-rainbow-delimiters-depth-1">[</span>o, me_5, me_9, me_13, me_17, me_21<span class="org-rainbow-delimiters-depth-1">]</span>

Plotting.image_subplot_style<span class="org-rainbow-delimiters-depth-1">(</span>2, 3, image_array<span class="org-operator">=</span>image_array,
    show<span class="org-operator">=</span><span class="org-constant">False</span>,
    publish<span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/dilation-comparison"</span>,
    rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>

</pre>
</div>


<div id="orgdd18411" class="figure">
<p><img src="images/Morphological-Operations/dilation-comparison.png" alt="dilation-comparison.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org18724db" class="outline-3">
<h3 id="org18724db">Opening</h3>
<div class="outline-text-3" id="text-org18724db">
<div class="org-src-container">
<pre class="src src-python" id="org8b9cfb1"><span class="org-keyword">def</span> <span class="org-function-name">morph_opening</span><span class="org-rainbow-delimiters-depth-1">(</span>image, kernel, show<span class="org-operator">=</span><span class="org-constant">None</span>, publish<span class="org-operator">=</span><span class="org-constant">None</span>, rgb<span class="org-operator">=</span><span class="org-constant">None</span><span class="org-rainbow-delimiters-depth-1">)</span>:
    <span class="org-variable-name">opening</span> <span class="org-operator">=</span> cv.morphologyEx<span class="org-rainbow-delimiters-depth-1">(</span>cv.imread<span class="org-rainbow-delimiters-depth-2">(</span>image<span class="org-rainbow-delimiters-depth-2">)</span>, cv.MORPH_OPEN, kernel<span class="org-rainbow-delimiters-depth-1">)</span>

    Plotting.image_subplot_style<span class="org-rainbow-delimiters-depth-1">(</span>1, 2, image_array<span class="org-operator">=</span><span class="org-rainbow-delimiters-depth-2">[</span>cv.imread<span class="org-rainbow-delimiters-depth-3">(</span>image<span class="org-rainbow-delimiters-depth-3">)</span>, opening<span class="org-rainbow-delimiters-depth-2">]</span>,
                                 show<span class="org-operator">=</span><span class="org-constant">False</span>,
                                 publish<span class="org-operator">=</span>publish,
                                 rgb<span class="org-operator">=</span>rgb<span class="org-rainbow-delimiters-depth-1">)</span>

    <span class="org-keyword">return</span> cv.imread<span class="org-rainbow-delimiters-depth-1">(</span>image<span class="org-rainbow-delimiters-depth-1">)</span>, opening
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org1019b5e"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>5<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_opening<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/opening-k-5"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="org2457766" class="figure">
<p><img src="images/Morphological-Operations/opening-k-5.png" alt="opening-k-5.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="orgfca5d4d"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>9<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_opening<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/opening-k-9"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="orgab145ca" class="figure">
<p><img src="images/Morphological-Operations/opening-k-9.png" alt="opening-k-9.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="orge3474d6"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>13<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_opening<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/opening-k-13"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="org2d42e30" class="figure">
<p><img src="images/Morphological-Operations/opening-k-13.png" alt="opening-k-13.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org4832921"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>17<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_opening<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/opening-k-17"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="org04c9f4a" class="figure">
<p><img src="images/Morphological-Operations/opening-k-17.png" alt="opening-k-17.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org6a72dfa"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>21<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_opening<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/opening-k-21"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="orgf8a5fd9" class="figure">
<p><img src="images/Morphological-Operations/opening-k-21.png" alt="opening-k-21.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org0af8ec7"><span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_5</span> <span class="org-operator">=</span> morph_opening<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>5<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_9</span> <span class="org-operator">=</span> morph_opening<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>9<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_13</span> <span class="org-operator">=</span> morph_opening<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>13<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_17</span> <span class="org-operator">=</span> morph_opening<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>17<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_21</span> <span class="org-operator">=</span> morph_opening<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>21<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-variable-name">image_array</span><span class="org-operator">=</span><span class="org-rainbow-delimiters-depth-1">[</span>o, me_5, me_9, me_13, me_17, me_21<span class="org-rainbow-delimiters-depth-1">]</span>

Plotting.image_subplot_style<span class="org-rainbow-delimiters-depth-1">(</span>2, 3, image_array<span class="org-operator">=</span>image_array,
                             show<span class="org-operator">=</span><span class="org-constant">False</span>,
                             publish<span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/opening-comparison"</span>,
                             rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>

</pre>
</div>


<div id="orgcb8dd0e" class="figure">
<p><img src="images/Morphological-Operations/closing-comparison.png" alt="closing-comparison.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org80fa906" class="outline-3">
<h3 id="org80fa906">Closing</h3>
<div class="outline-text-3" id="text-org80fa906">
<p>
the closing of a set (binary image) A by a structuring element B is the erosion of the dilation of that set,
</p>

\begin{equation*}
 A\bullet B=(A\oplus B)\ominus B
\end{equation*}

<p>
where \(\oplus\) and $\ominus denote the dilation and erosion, respectively.
</p>

<p>
In image processing, closing is, together with opening, the basic workhorse of morphological
noise removal. Opening removes small objects, while closing removes small holes. 
</p>

<div class="org-src-container">
<pre class="src src-python" id="orgdc8f56c"><span class="org-keyword">def</span> <span class="org-function-name">morph_closing</span><span class="org-rainbow-delimiters-depth-1">(</span>image, kernel, show<span class="org-operator">=</span><span class="org-constant">None</span>, publish<span class="org-operator">=</span><span class="org-constant">None</span>, rgb<span class="org-operator">=</span><span class="org-constant">None</span><span class="org-rainbow-delimiters-depth-1">)</span>:
       <span class="org-variable-name">closing</span> <span class="org-operator">=</span> cv.morphologyEx<span class="org-rainbow-delimiters-depth-1">(</span>cv.imread<span class="org-rainbow-delimiters-depth-2">(</span>image<span class="org-rainbow-delimiters-depth-2">)</span>, cv.MORPH_CLOSE, kernel<span class="org-rainbow-delimiters-depth-1">)</span>

       Plotting.image_subplot_style<span class="org-rainbow-delimiters-depth-1">(</span>1, 2, image_array<span class="org-operator">=</span><span class="org-rainbow-delimiters-depth-2">[</span>cv.imread<span class="org-rainbow-delimiters-depth-3">(</span>image<span class="org-rainbow-delimiters-depth-3">)</span>, closing<span class="org-rainbow-delimiters-depth-2">]</span>,
                                    show<span class="org-operator">=</span>show,
                                    publish<span class="org-operator">=</span>publish,
                                    rgb<span class="org-operator">=</span>rgb<span class="org-rainbow-delimiters-depth-1">)</span>

       <span class="org-keyword">return</span> cv.imread<span class="org-rainbow-delimiters-depth-1">(</span>image<span class="org-rainbow-delimiters-depth-1">)</span>, closing
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org42f7b75"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>5<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_closing<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/opening-k-5"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="org9f07323" class="figure">
<p><img src="images/Morphological-Operations/opening-k-5.png" alt="opening-k-5.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org2ae2ef5"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>9<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_closing<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/opening-k-9"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="org05341b7" class="figure">
<p><img src="images/Morphological-Operations/opening-k-9.png" alt="opening-k-9.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org341169a"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>13<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_closing<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/opening-k-13"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="org0bf342d" class="figure">
<p><img src="images/Morphological-Operations/opening-k-13.png" alt="opening-k-13.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="orgc414400"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>17<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_closing<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/opening-k-17"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="orgfe94050" class="figure">
<p><img src="images/Morphological-Operations/opening-k-17.png" alt="opening-k-17.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="orgff8baad"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>21<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_closing<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/opening-k-21"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org5ef9003"><span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_5</span> <span class="org-operator">=</span> morph_closing<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>5<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_9</span> <span class="org-operator">=</span> morph_closing<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>9<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_13</span> <span class="org-operator">=</span> morph_closing<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>13<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_17</span> <span class="org-operator">=</span> morph_closing<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>17<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_21</span> <span class="org-operator">=</span> morph_closing<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>21<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-variable-name">image_array</span><span class="org-operator">=</span><span class="org-rainbow-delimiters-depth-1">[</span>o, me_5, me_9, me_13, me_17, me_21<span class="org-rainbow-delimiters-depth-1">]</span>

Plotting.image_subplot_style<span class="org-rainbow-delimiters-depth-1">(</span>2, 3, image_array<span class="org-operator">=</span>image_array,
                             show<span class="org-operator">=</span><span class="org-constant">False</span>,
                             publish<span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/closing-comparison"</span>,
                             rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>

</pre>
</div>


<div id="orgb6318c3" class="figure">
<p><img src="images/Morphological-Operations/closing-comparison.png" alt="closing-comparison.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org13e9d8f" class="outline-3">
<h3 id="org13e9d8f">Gradient</h3>
<div class="outline-text-3" id="text-org13e9d8f">
<p>
It is the difference between the dilation and the erosion of a given image.
It is an image where each pixel value (typically non-negative) indicates the
contrast intensity in the close neighborhood of that pixel. It is useful
for edge detection and segmentation applications. 
</p>

<div class="org-src-container">
<pre class="src src-python" id="org01c07b3"><span class="org-keyword">def</span> <span class="org-function-name">morph_gradient</span><span class="org-rainbow-delimiters-depth-1">(</span>image, kernel, show<span class="org-operator">=</span><span class="org-constant">None</span>, publish<span class="org-operator">=</span><span class="org-constant">None</span>, rgb<span class="org-operator">=</span><span class="org-constant">None</span><span class="org-rainbow-delimiters-depth-1">)</span>:

    <span class="org-variable-name">gradient</span> <span class="org-operator">=</span> cv.morphologyEx<span class="org-rainbow-delimiters-depth-1">(</span>cv.imread<span class="org-rainbow-delimiters-depth-2">(</span>image<span class="org-rainbow-delimiters-depth-2">)</span>, cv.MORPH_GRADIENT, kernel<span class="org-rainbow-delimiters-depth-1">)</span>

    Plotting.image_subplot_style<span class="org-rainbow-delimiters-depth-1">(</span>1, 2, image_array<span class="org-operator">=</span><span class="org-rainbow-delimiters-depth-2">[</span>cv.imread<span class="org-rainbow-delimiters-depth-3">(</span>image<span class="org-rainbow-delimiters-depth-3">)</span>, gradient<span class="org-rainbow-delimiters-depth-2">]</span>,
                                 show<span class="org-operator">=</span>show,
                                 publish<span class="org-operator">=</span>publish,
                                 rgb<span class="org-operator">=</span>rgb<span class="org-rainbow-delimiters-depth-1">)</span>

    <span class="org-keyword">return</span> cv.imread<span class="org-rainbow-delimiters-depth-1">(</span>image<span class="org-rainbow-delimiters-depth-1">)</span>, gradient
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="orgbd0eca2"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>5<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_gradient<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/gradient-k-5"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="org7b97a64" class="figure">
<p><img src="images/Morphological-Operations/gradient-k-5.png" alt="gradient-k-5.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="orgc692d6b"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>9<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_gradient<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/gradient-k-9"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="orgb835a91" class="figure">
<p><img src="images/Morphological-Operations/gradient-k-9.png" alt="gradient-k-9.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org6442ccb"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>13<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_gradient<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/gradient-k-13"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="orgd363e3b" class="figure">
<p><img src="images/Morphological-Operations/gradient-k-13.png" alt="gradient-k-13.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org451efce"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>17<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_gradient<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/gradient-k-17"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="org00b5d78" class="figure">
<p><img src="images/Morphological-Operations/gradient-k-17.png" alt="gradient-k-17.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org534e43e"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>21<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_gradient<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/gradient-k-21"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="orgdba30c1" class="figure">
<p><img src="images/Morphological-Operations/gradient-k-21.png" alt="gradient-k-21.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="orgfb46381"><span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_5</span> <span class="org-operator">=</span> morph_gradient<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>5<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_9</span> <span class="org-operator">=</span> morph_gradient<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>9<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_13</span> <span class="org-operator">=</span> morph_gradient<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>13<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_17</span> <span class="org-operator">=</span> morph_gradient<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>17<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_21</span> <span class="org-operator">=</span> morph_gradient<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>21<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-variable-name">image_array</span><span class="org-operator">=</span><span class="org-rainbow-delimiters-depth-1">[</span>o, me_5, me_9, me_13, me_17, me_21<span class="org-rainbow-delimiters-depth-1">]</span>

Plotting.image_subplot_style<span class="org-rainbow-delimiters-depth-1">(</span>2, 3, image_array<span class="org-operator">=</span>image_array,
                             show<span class="org-operator">=</span><span class="org-constant">False</span>,
                             publish<span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/gradient-comparison"</span>,
                             rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>

</pre>
</div>


<div id="org50045b9" class="figure">
<p><img src="images/Morphological-Operations/gradient-comparison.png" alt="gradient-comparison.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org9ad930f" class="outline-3">
<h3 id="org9ad930f">Tophat</h3>
<div class="outline-text-3" id="text-org9ad930f">
<p>
Top-hat transform is an operation that extracts small elements and details from given images.
There exist two types of top-hat transform:
</p>

<ol class="org-ol">
<li>top-hat transform is defined as the difference between the input image and its opening by
some structuring element,</li>
<li>black top-hat transform is defined dually as the difference between the closing and the input image.</li>
</ol>

<p>
Top-hat transforms are used for various image processing tasks, such as feature extraction,
background equalization, image enhancement, and others. 
</p>
</div>

<div id="outline-container-orga357ae8" class="outline-4">
<h4 id="orga357ae8">White Top-hat</h4>
<div class="outline-text-4" id="text-orga357ae8">
<p>
Used to enhance bright objects of interest in a dark background. 
</p>

<div class="org-src-container">
<pre class="src src-python" id="org747fbbd"><span class="org-keyword">def</span> <span class="org-function-name">morph_tophat</span><span class="org-rainbow-delimiters-depth-1">(</span>image, kernel, show<span class="org-operator">=</span><span class="org-constant">None</span>, publish<span class="org-operator">=</span><span class="org-constant">None</span>, rgb<span class="org-operator">=</span><span class="org-constant">None</span><span class="org-rainbow-delimiters-depth-1">)</span>:

        <span class="org-variable-name">hat</span> <span class="org-operator">=</span> cv.morphologyEx<span class="org-rainbow-delimiters-depth-1">(</span>cv.imread<span class="org-rainbow-delimiters-depth-2">(</span>image<span class="org-rainbow-delimiters-depth-2">)</span>, cv.MORPH_TOPHAT, kernel<span class="org-rainbow-delimiters-depth-1">)</span>

        Plotting.image_subplot_style<span class="org-rainbow-delimiters-depth-1">(</span>1, 2, image_array<span class="org-operator">=</span><span class="org-rainbow-delimiters-depth-2">[</span>cv.imread<span class="org-rainbow-delimiters-depth-3">(</span>image<span class="org-rainbow-delimiters-depth-3">)</span>, hat<span class="org-rainbow-delimiters-depth-2">]</span>,
                                     show<span class="org-operator">=</span>show,
                                     publish<span class="org-operator">=</span>publish,
                                     rgb<span class="org-operator">=</span>rgb<span class="org-rainbow-delimiters-depth-1">)</span>

        <span class="org-keyword">return</span> cv.imread<span class="org-rainbow-delimiters-depth-1">(</span>image<span class="org-rainbow-delimiters-depth-1">)</span>, hat
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="orgfb68761"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>5<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_tophat<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/tophat-k-5"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="orgd4a2d7d" class="figure">
<p><img src="images/Morphological-Operations/tophat-k-5.png" alt="tophat-k-5.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org1eb774f"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>9<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_tophat<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/tophat-k-9"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="orgee42b11" class="figure">
<p><img src="images/Morphological-Operations/tophat-k-9.png" alt="tophat-k-9.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org5a5f397"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>13<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_tophat<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/tophat-k-13"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="org5b373c3" class="figure">
<p><img src="images/Morphological-Operations/tophat-k-13.png" alt="tophat-k-13.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org94220b8"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>17<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_tophat<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/tophat-k-17"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="org28156c8" class="figure">
<p><img src="images/Morphological-Operations/tophat-k-17.png" alt="tophat-k-17.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org9abae2f"><span class="org-variable-name">kernel</span> <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-1">(</span>21<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">di</span> <span class="org-operator">=</span> morph_tophat<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel,
                       publish <span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/tophat-k-21"</span>,
                       show<span class="org-operator">=</span><span class="org-constant">False</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>


<div id="orga59aafa" class="figure">
<p><img src="images/Morphological-Operations/tophat-k-21.png" alt="tophat-k-21.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org8d8ed93"><span class="org-variable-name">image</span> <span class="org-operator">=</span> <span class="org-string">"Fruit.jpg"</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_5</span> <span class="org-operator">=</span> morph_tophat<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>5<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_9</span> <span class="org-operator">=</span> morph_tophat<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>9<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_13</span> <span class="org-operator">=</span> morph_tophat<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>13<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_17</span> <span class="org-operator">=</span> morph_tophat<span class="org-rainbow-delimiters-depth-1">(</span>image,kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>17<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">o</span>, <span class="org-variable-name">me_21</span> <span class="org-operator">=</span> morph_tophat<span class="org-rainbow-delimiters-depth-1">(</span>image, kernel <span class="org-operator">=</span> np.ones<span class="org-rainbow-delimiters-depth-2">(</span>21<span class="org-rainbow-delimiters-depth-2">)</span>, rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-variable-name">image_array</span><span class="org-operator">=</span><span class="org-rainbow-delimiters-depth-1">[</span>o, me_5, me_9, me_13, me_17, me_21<span class="org-rainbow-delimiters-depth-1">]</span>

Plotting.image_subplot_style<span class="org-rainbow-delimiters-depth-1">(</span>2, 3, image_array<span class="org-operator">=</span>image_array,
                             show<span class="org-operator">=</span><span class="org-constant">False</span>,
                             publish<span class="org-operator">=</span><span class="org-string">"images/Morphological-Operations/tophat-comparison"</span>,
                             rgb<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>

</pre>
</div>


<div id="orgaf1cce6" class="figure">
<p><img src="images/Morphological-Operations/tophat-comparison.png" alt="tophat-comparison.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org4071603" class="outline-4">
<h4 id="org4071603">Blackhat</h4>
<div class="outline-text-4" id="text-org4071603">
<p>
The black-hat operation is used to do the opposite,
enhance dark objects of interest in a bright background.
</p>

<div class="org-src-container">
<pre class="src src-python" id="org010109b"><span class="org-keyword">def</span> <span class="org-function-name">morph_blackhat</span><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">self</span>, show<span class="org-operator">=</span><span class="org-constant">None</span>, publish<span class="org-operator">=</span><span class="org-constant">None</span>, rgb<span class="org-operator">=</span><span class="org-constant">None</span><span class="org-rainbow-delimiters-depth-1">)</span>:

       <span class="org-variable-name">black_hat</span> <span class="org-operator">=</span> cv.morphologyEx<span class="org-rainbow-delimiters-depth-1">(</span>cv.imread<span class="org-rainbow-delimiters-depth-2">(</span>image<span class="org-rainbow-delimiters-depth-2">)</span>, cv.MORPH_BLACKHAT, <span class="org-keyword">self</span>.kernel<span class="org-rainbow-delimiters-depth-1">)</span>

       <span class="org-keyword">if</span> show:
              Plotting.image_subplot_style<span class="org-rainbow-delimiters-depth-1">(</span>1, 2, image_array<span class="org-operator">=</span><span class="org-rainbow-delimiters-depth-2">[</span>cv.imread<span class="org-rainbow-delimiters-depth-3">(</span>image<span class="org-rainbow-delimiters-depth-3">)</span>, black_hat<span class="org-rainbow-delimiters-depth-2">]</span>,
                                           show<span class="org-operator">=</span>show,
                                           publish<span class="org-operator">=</span>publish,
                                           rgb<span class="org-operator">=</span>rgb<span class="org-rainbow-delimiters-depth-1">)</span>

       <span class="org-keyword">return</span> cv.imread<span class="org-rainbow-delimiters-depth-1">(</span>image<span class="org-rainbow-delimiters-depth-1">)</span>, black_hat
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org5e37787" class="outline-2">
<h2 id="org5e37787">Application: Morphological Filtering</h2>
<div class="outline-text-2" id="text-org5e37787">
<div class="org-src-container">
<pre class="src src-python" id="org3cfad2a"><span class="org-keyword">import</span> matplotlib.pyplot <span class="org-keyword">as</span> plt
<span class="org-keyword">from</span> skimage <span class="org-keyword">import</span> data
<span class="org-keyword">from</span> skimage.util <span class="org-keyword">import</span> img_as_ubyte

<span class="org-variable-name">orig_phantom</span> <span class="org-operator">=</span> img_as_ubyte<span class="org-rainbow-delimiters-depth-1">(</span>data.shepp_logan_phantom<span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">fig</span>, <span class="org-variable-name">ax</span> <span class="org-operator">=</span> plt.subplots<span class="org-rainbow-delimiters-depth-1">()</span>
ax.imshow<span class="org-rainbow-delimiters-depth-1">(</span>orig_phantom, cmap<span class="org-operator">=</span>plt.cm.gray<span class="org-rainbow-delimiters-depth-1">)</span>
plt.show<span class="org-rainbow-delimiters-depth-1">()</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org7ac94df"><span class="org-keyword">def</span> <span class="org-function-name">plot_comparison</span><span class="org-rainbow-delimiters-depth-1">(</span>original, filtered, filter_name<span class="org-rainbow-delimiters-depth-1">)</span>:
    fig, <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">ax1</span>, <span class="org-variable-name">ax2</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-operator">=</span> plt.subplots<span class="org-rainbow-delimiters-depth-1">(</span>ncols<span class="org-operator">=</span>2, figsize<span class="org-operator">=</span><span class="org-rainbow-delimiters-depth-2">(</span>8, 4<span class="org-rainbow-delimiters-depth-2">)</span>, sharex<span class="org-operator">=</span><span class="org-constant">True</span>, sharey<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>
    ax1.imshow<span class="org-rainbow-delimiters-depth-1">(</span>original, cmap<span class="org-operator">=</span>plt.cm.gray<span class="org-rainbow-delimiters-depth-1">)</span>
    ax1.set_title<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'original'</span><span class="org-rainbow-delimiters-depth-1">)</span>
    ax1.set_axis_off<span class="org-rainbow-delimiters-depth-1">()</span>
    ax2.imshow<span class="org-rainbow-delimiters-depth-1">(</span>filtered, cmap<span class="org-operator">=</span>plt.cm.gray<span class="org-rainbow-delimiters-depth-1">)</span>
    ax2.set_title<span class="org-rainbow-delimiters-depth-1">(</span>filter_name<span class="org-rainbow-delimiters-depth-1">)</span>
    ax2.set_axis_off<span class="org-rainbow-delimiters-depth-1">()</span>
</pre>
</div>
</div>

<div id="outline-container-orgcdb311c" class="outline-3">
<h3 id="orgcdb311c">Erosion</h3>
<div class="outline-text-3" id="text-orgcdb311c">
<p>
Morphological erosion sets a pixel at (i, j) to the minimum over all
pixels in the neighborhood centered at (i, j). The structuring element,
footprint, passed to erosion is a boolean array that describes this
neighborhood. Below, we use disk to create a circular structuring
element, which we use for most of the following examples.
</p>

<div class="org-src-container">
<pre class="src src-python" id="orgc4c8419"><span class="org-keyword">from</span> skimage.morphology <span class="org-keyword">import</span> erosion, dilation, opening, closing, white_tophat  <span class="org-comment-delimiter"># </span><span class="org-comment">noqa</span>
<span class="org-keyword">from</span> skimage.morphology <span class="org-keyword">import</span> black_tophat, skeletonize, convex_hull_image  <span class="org-comment-delimiter"># </span><span class="org-comment">noqa</span>
<span class="org-keyword">from</span> skimage.morphology <span class="org-keyword">import</span> disk  <span class="org-comment-delimiter"># </span><span class="org-comment">noqa</span>

<span class="org-variable-name">footprint</span> <span class="org-operator">=</span> disk<span class="org-rainbow-delimiters-depth-1">(</span>6<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">eroded</span> <span class="org-operator">=</span> erosion<span class="org-rainbow-delimiters-depth-1">(</span>orig_phantom, footprint<span class="org-rainbow-delimiters-depth-1">)</span>
plot_comparison<span class="org-rainbow-delimiters-depth-1">(</span>orig_phantom, eroded, <span class="org-string">'erosion'</span><span class="org-rainbow-delimiters-depth-1">)</span>
plt.show<span class="org-rainbow-delimiters-depth-1">()</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc2d9151" class="outline-2">
<h2 id="orgc2d9151">Application: Filtering Maps for Logistic Mapping</h2>
<div class="outline-text-2" id="text-orgc2d9151">
<p>
For businesses dealing with logistics, delivery services, or
transportation, understanding and analyzing road networks is critical.
</p>

<p>
Here, we will demonstrate how morphological operations can help such
businesses by focusing on the road networks in maps. Let us use the
map below:
</p>

<p>
We start with a grayscale version of the map image,
then apply a manual threshold to binarise it:
</p>

<div class="org-src-container">
<pre class="src src-python" id="orgecc811b"><span class="org-keyword">import</span> skimage <span class="org-keyword">as</span> sk
<span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np
<span class="org-keyword">from</span> skimage.color <span class="org-keyword">import</span> rgb2gray
<span class="org-keyword">from</span> skimage.io <span class="org-keyword">import</span> imshow
<span class="org-variable-name">image_raw</span> <span class="org-operator">=</span> sk.io.imread<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'images/data/innsbruck-map.png'</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">im</span> <span class="org-operator">=</span> rgb2gray<span class="org-rainbow-delimiters-depth-1">(</span>image_raw<span class="org-rainbow-delimiters-depth-2">[</span>:, :, :3<span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">im_bw</span> <span class="org-operator">=</span> im <span class="org-operator">&gt;</span> 0.90
sk.io.imsave<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"images/Morphological-Operations/innsbruck-bw.png"</span>,im_bw<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
To filter out the roads, we apply a series of morphological operations.
We first perform opening to remove small patches of white that are not
part of the roads. Then, we apply closing to fill in gaps within the
roads:
</p>

<div class="org-src-container">
<pre class="src src-python" id="org15e070b"><span class="org-keyword">from</span> skimage.morphology <span class="org-keyword">import</span> closing, opening

<span class="org-variable-name">selem_temp</span> <span class="org-operator">=</span> np.array<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">[</span><span class="org-rainbow-delimiters-depth-3">[</span><span class="org-operator">-</span>1, <span class="org-operator">-</span>1, <span class="org-operator">-</span>1, <span class="org-operator">-</span>1<span class="org-rainbow-delimiters-depth-3">]</span>,
                       <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-operator">-</span>1, 8.5, 8.5, <span class="org-operator">-</span>1<span class="org-rainbow-delimiters-depth-3">]</span>,
                       <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-operator">-</span>1, 8.5, 8.5, <span class="org-operator">-</span>1<span class="org-rainbow-delimiters-depth-3">]</span>,
                       <span class="org-rainbow-delimiters-depth-3">[</span><span class="org-operator">-</span>1, <span class="org-operator">-</span>1, <span class="org-operator">-</span>1, <span class="org-operator">-</span>1<span class="org-rainbow-delimiters-depth-3">]</span><span class="org-rainbow-delimiters-depth-2">]</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-variable-name">map1</span> <span class="org-operator">=</span> closing<span class="org-rainbow-delimiters-depth-1">(</span>opening<span class="org-rainbow-delimiters-depth-2">(</span>im_bw, selem_temp<span class="org-rainbow-delimiters-depth-2">)</span>, selem_temp<span class="org-rainbow-delimiters-depth-1">)</span>
sk.io.imsave<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"images/Morphological-Operations/innsbruck-bw-2.png"</span>,map1<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="orgf45f809"><span class="org-keyword">from</span> skimage.morphology <span class="org-keyword">import</span> erosion, dilation
<span class="org-keyword">from</span> skimage.draw <span class="org-keyword">import</span> disk

<span class="org-keyword">def</span> <span class="org-function-name">im_dilation</span><span class="org-rainbow-delimiters-depth-1">(</span>image, selem, n<span class="org-rainbow-delimiters-depth-1">)</span>:
    <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-builtin">range</span><span class="org-rainbow-delimiters-depth-1">(</span>n<span class="org-rainbow-delimiters-depth-1">)</span>:
        <span class="org-variable-name">image</span> <span class="org-operator">=</span> dilation<span class="org-rainbow-delimiters-depth-1">(</span>image, selem<span class="org-rainbow-delimiters-depth-1">)</span>
    <span class="org-keyword">return</span> image

<span class="org-keyword">def</span> <span class="org-function-name">im_erosion</span><span class="org-rainbow-delimiters-depth-1">(</span>image, selem, n<span class="org-rainbow-delimiters-depth-1">)</span>:
    <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-builtin">range</span><span class="org-rainbow-delimiters-depth-1">(</span>n<span class="org-rainbow-delimiters-depth-1">)</span>:
        <span class="org-variable-name">image</span> <span class="org-operator">=</span> erosion<span class="org-rainbow-delimiters-depth-1">(</span>image, selem<span class="org-rainbow-delimiters-depth-1">)</span>
    <span class="org-keyword">return</span> image

<span class="org-variable-name">map2</span> <span class="org-operator">=</span> im_dilation<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>im_erosion<span class="org-rainbow-delimiters-depth-3">(</span>map1, selem_temp, 2<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>, selem_temp, 4<span class="org-rainbow-delimiters-depth-1">)</span>
sk.io.imsave<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"images/Morphological-Operations/innsbruck-bw-3.png"</span>,map2<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<pre class="example" id="org74d88a7">
/var/folders/c2/_hry6n9d5v1527pv4f_gfjxm0000gn/T/babel-8nwK5j/python-yXo5l3:17: UserWarning: images/Morphological-Operations/innsbruck-bw-3.png is a boolean image: setting True to 255 and False to 0. To silence this warning, please convert the image using img_as_ubyte.
  sk.io.imsave("images/Morphological-Operations/innsbruck-bw-3.png",map2)
</pre>

<div class="org-src-container">
<pre class="src src-python" id="org522f35f"><span class="org-keyword">from</span> skimage.morphology <span class="org-keyword">import</span> skeletonize

<span class="org-variable-name">skeleton</span> <span class="org-operator">=</span> skeletonize<span class="org-rainbow-delimiters-depth-1">(</span>np.invert<span class="org-rainbow-delimiters-depth-2">(</span>map2<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
sk.io.imsave<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"images/Morphological-Operations/innsbruck-bw-4.png"</span>,skeleton<span class="org-rainbow-delimiters-depth-1">)</span>


<span class="org-variable-name">skel_count</span> <span class="org-operator">=</span> np.<span class="org-builtin">sum</span><span class="org-rainbow-delimiters-depth-1">(</span>skeleton<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-builtin">print</span><span class="org-rainbow-delimiters-depth-1">(</span>f<span class="org-string">'Pixel length of all roads = </span>{skel_count}<span class="org-string"> pixels'</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<pre class="example" id="org90e8692">
Pixel length of all roads = 13390 pixels
</pre>
</div>
</div>

<div id="outline-container-org53f0efe" class="outline-2">
<h2 id="org53f0efe">Application: Measure fluorescence intensity at the nuclear envelope</h2>
<div class="outline-text-2" id="text-org53f0efe">
<p>
This example reproduces a well-established workflow in bioimage
data analysis for measuring the fluorescence intensity localized
to the nuclear envelope, in a time sequence of cell images
(each with two channels and two spatial dimensions)
which shows a process of protein re-localization from the
cytoplasmic area to the nuclear envelope. 
</p>

<div class="org-src-container">
<pre class="src src-python" id="org1913192"><span class="org-keyword">import</span> matplotlib.pyplot <span class="org-keyword">as</span> plt
<span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np
<span class="org-keyword">import</span> plotly.io
<span class="org-keyword">import</span> plotly.express <span class="org-keyword">as</span> px
<span class="org-keyword">from</span> scipy <span class="org-keyword">import</span> ndimage <span class="org-keyword">as</span> ndi

<span class="org-keyword">from</span> skimage <span class="org-keyword">import</span> filters, measure, morphology, segmentation
<span class="org-keyword">from</span> skimage.data <span class="org-keyword">import</span> protein_transport
</pre>
</div>

<p>
We start with a single cell/nucleus to
construct the workflow.
</p>

<div class="org-src-container">
<pre class="src src-python" id="orgc3795ba"><span class="org-variable-name">image_sequence</span> <span class="org-operator">=</span> protein_transport<span class="org-rainbow-delimiters-depth-1">()</span>

<span class="org-builtin">print</span><span class="org-rainbow-delimiters-depth-1">(</span>f<span class="org-string">'shape: </span>{image_sequence.shape}<span class="org-string">'</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
The dataset is a 2D image stack with 15 frames
(time points) and 2 channels.
</p>

<div class="org-src-container">
<pre class="src src-python" id="orgf4265fc"><span class="org-variable-name">vmin</span>, <span class="org-variable-name">vmax</span> <span class="org-operator">=</span> 0, image_sequence.<span class="org-builtin">max</span><span class="org-rainbow-delimiters-depth-1">()</span>

<span class="org-variable-name">fig</span> <span class="org-operator">=</span> px.imshow<span class="org-rainbow-delimiters-depth-1">(</span>
    image_sequence,
    facet_col<span class="org-operator">=</span>1,
    animation_frame<span class="org-operator">=</span>0,
    zmin<span class="org-operator">=</span>vmin,
    zmax<span class="org-operator">=</span>vmax,
    binary_string<span class="org-operator">=</span><span class="org-constant">True</span>,
    labels<span class="org-operator">=</span><span class="org-rainbow-delimiters-depth-2">{</span><span class="org-string">'animation_frame'</span>: <span class="org-string">'time point'</span>, <span class="org-string">'facet_col'</span>: <span class="org-string">'channel'</span><span class="org-rainbow-delimiters-depth-2">}</span>,
<span class="org-rainbow-delimiters-depth-1">)</span>
plotly.io.show<span class="org-rainbow-delimiters-depth-1">(</span>fig<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
To begin with, let us consider the first
channel of the first image.
</p>

<div class="org-src-container">
<pre class="src src-python" id="org4161a6f"><span class="org-variable-name">image_t_0_channel_0</span> <span class="org-operator">=</span> image_sequence<span class="org-rainbow-delimiters-depth-1">[</span>0, 0, :, :<span class="org-rainbow-delimiters-depth-1">]</span>
</pre>
</div>
</div>

<div id="outline-container-org7ac20ae" class="outline-3">
<h3 id="org7ac20ae">Segment the Nucleus Rim</h3>
<div class="outline-text-3" id="text-org7ac20ae">
<p>
Let us apply a Gaussian low-pass filter to this image in
order to smooth it. Next, we segment the nuclei,
finding the threshold between the background and foreground
with Otsus method: We get a binary image.
</p>

<p>
We then fill the holes in the objects.
</p>

<div class="org-src-container">
<pre class="src src-python" id="org69c909f"><span class="org-variable-name">smooth</span> <span class="org-operator">=</span> filters.gaussian<span class="org-rainbow-delimiters-depth-1">(</span>image_t_0_channel_0, sigma<span class="org-operator">=</span>1.5<span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-variable-name">thresh_value</span> <span class="org-operator">=</span> filters.threshold_otsu<span class="org-rainbow-delimiters-depth-1">(</span>smooth<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">thresh</span> <span class="org-operator">=</span> smooth <span class="org-operator">&gt;</span> thresh_value

<span class="org-variable-name">fill</span> <span class="org-operator">=</span> ndi.binary_fill_holes<span class="org-rainbow-delimiters-depth-1">(</span>thresh<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
Following the original workflow, let us remove objects which
touch the image border. Here, we can see that part of
another nucleus was touching the bottom right-hand corner.
</p>

<div class="org-src-container">
<pre class="src src-python" id="org2d7afcb"><span class="org-variable-name">clear</span> <span class="org-operator">=</span> segmentation.clear_border<span class="org-rainbow-delimiters-depth-1">(</span>fill<span class="org-rainbow-delimiters-depth-1">)</span>
clear.dtype
</pre>
</div>

<p>
We compute both the morphological dilation of this binary
image and its morphological erosion.
</p>

<div class="org-src-container">
<pre class="src src-python" id="org25412d2"><span class="org-variable-name">dilate</span> <span class="org-operator">=</span> morphology.binary_dilation<span class="org-rainbow-delimiters-depth-1">(</span>clear<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-variable-name">erode</span> <span class="org-operator">=</span> morphology.binary_erosion<span class="org-rainbow-delimiters-depth-1">(</span>clear<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
Finally, we subtract the eroded from the dilated to get
the nucleus rim. This is equivalent to selecting the pixels
which are in <span class="Code">dilate</span>, but not in <span class="Code">erode</span>:
</p>

<div class="org-src-container">
<pre class="src src-python" id="org0eaa06a"><span class="org-variable-name">mask</span> <span class="org-operator">=</span> np.logical_and<span class="org-rainbow-delimiters-depth-1">(</span>dilate, <span class="org-operator">~</span>erode<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
Let us visualize these processing steps in a
sequence of subplots.
</p>

<div class="org-src-container">
<pre class="src src-python" id="orgb7f187e"><span class="org-variable-name">fig</span>, <span class="org-variable-name">ax</span> <span class="org-operator">=</span> plt.subplots<span class="org-rainbow-delimiters-depth-1">(</span>2, 4, figsize<span class="org-operator">=</span><span class="org-rainbow-delimiters-depth-2">(</span>12, 6<span class="org-rainbow-delimiters-depth-2">)</span>, sharey<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>

ax<span class="org-rainbow-delimiters-depth-1">[</span>0, 0<span class="org-rainbow-delimiters-depth-1">]</span>.imshow<span class="org-rainbow-delimiters-depth-1">(</span>image_t_0_channel_0, cmap<span class="org-operator">=</span>plt.cm.gray<span class="org-rainbow-delimiters-depth-1">)</span>
ax<span class="org-rainbow-delimiters-depth-1">[</span>0, 0<span class="org-rainbow-delimiters-depth-1">]</span>.set_title<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'a) Raw'</span><span class="org-rainbow-delimiters-depth-1">)</span>

ax<span class="org-rainbow-delimiters-depth-1">[</span>0, 1<span class="org-rainbow-delimiters-depth-1">]</span>.imshow<span class="org-rainbow-delimiters-depth-1">(</span>smooth, cmap<span class="org-operator">=</span>plt.cm.gray<span class="org-rainbow-delimiters-depth-1">)</span>
ax<span class="org-rainbow-delimiters-depth-1">[</span>0, 1<span class="org-rainbow-delimiters-depth-1">]</span>.set_title<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'b) Blur'</span><span class="org-rainbow-delimiters-depth-1">)</span>

ax<span class="org-rainbow-delimiters-depth-1">[</span>0, 2<span class="org-rainbow-delimiters-depth-1">]</span>.imshow<span class="org-rainbow-delimiters-depth-1">(</span>thresh, cmap<span class="org-operator">=</span>plt.cm.gray<span class="org-rainbow-delimiters-depth-1">)</span>
ax<span class="org-rainbow-delimiters-depth-1">[</span>0, 2<span class="org-rainbow-delimiters-depth-1">]</span>.set_title<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'c) Threshold'</span><span class="org-rainbow-delimiters-depth-1">)</span>

ax<span class="org-rainbow-delimiters-depth-1">[</span>0, 3<span class="org-rainbow-delimiters-depth-1">]</span>.imshow<span class="org-rainbow-delimiters-depth-1">(</span>fill, cmap<span class="org-operator">=</span>plt.cm.gray<span class="org-rainbow-delimiters-depth-1">)</span>
ax<span class="org-rainbow-delimiters-depth-1">[</span>0, 3<span class="org-rainbow-delimiters-depth-1">]</span>.set_title<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'c-1) Fill in'</span><span class="org-rainbow-delimiters-depth-1">)</span>

ax<span class="org-rainbow-delimiters-depth-1">[</span>1, 0<span class="org-rainbow-delimiters-depth-1">]</span>.imshow<span class="org-rainbow-delimiters-depth-1">(</span>clear, cmap<span class="org-operator">=</span>plt.cm.gray<span class="org-rainbow-delimiters-depth-1">)</span>
ax<span class="org-rainbow-delimiters-depth-1">[</span>1, 0<span class="org-rainbow-delimiters-depth-1">]</span>.set_title<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'c-2) Keep one nucleus'</span><span class="org-rainbow-delimiters-depth-1">)</span>

ax<span class="org-rainbow-delimiters-depth-1">[</span>1, 1<span class="org-rainbow-delimiters-depth-1">]</span>.imshow<span class="org-rainbow-delimiters-depth-1">(</span>dilate, cmap<span class="org-operator">=</span>plt.cm.gray<span class="org-rainbow-delimiters-depth-1">)</span>
ax<span class="org-rainbow-delimiters-depth-1">[</span>1, 1<span class="org-rainbow-delimiters-depth-1">]</span>.set_title<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'d) Dilate'</span><span class="org-rainbow-delimiters-depth-1">)</span>

ax<span class="org-rainbow-delimiters-depth-1">[</span>1, 2<span class="org-rainbow-delimiters-depth-1">]</span>.imshow<span class="org-rainbow-delimiters-depth-1">(</span>erode, cmap<span class="org-operator">=</span>plt.cm.gray<span class="org-rainbow-delimiters-depth-1">)</span>
ax<span class="org-rainbow-delimiters-depth-1">[</span>1, 2<span class="org-rainbow-delimiters-depth-1">]</span>.set_title<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'e) Erode'</span><span class="org-rainbow-delimiters-depth-1">)</span>

ax<span class="org-rainbow-delimiters-depth-1">[</span>1, 3<span class="org-rainbow-delimiters-depth-1">]</span>.imshow<span class="org-rainbow-delimiters-depth-1">(</span>mask, cmap<span class="org-operator">=</span>plt.cm.gray<span class="org-rainbow-delimiters-depth-1">)</span>
ax<span class="org-rainbow-delimiters-depth-1">[</span>1, 3<span class="org-rainbow-delimiters-depth-1">]</span>.set_title<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'f) Nucleus Rim'</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-keyword">for</span> a <span class="org-keyword">in</span> ax.ravel<span class="org-rainbow-delimiters-depth-1">()</span>:
    a.set_axis_off<span class="org-rainbow-delimiters-depth-1">()</span>

fig.tight_layout<span class="org-rainbow-delimiters-depth-1">()</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2368066" class="outline-3">
<h3 id="org2368066">Apply Segmented Rim as a Mask</h3>
<div class="outline-text-3" id="text-org2368066">
<p>
Now that we have segmented the nuclear membrane in
the first channel, we use it as a mask to measure the
intensity in the second channel.
</p>

<div class="org-src-container">
<pre class="src src-python" id="orgcce2adf"><span class="org-variable-name">image_t_0_channel_1</span> <span class="org-operator">=</span> image_sequence<span class="org-rainbow-delimiters-depth-1">[</span>0, 1, :, :<span class="org-rainbow-delimiters-depth-1">]</span>
<span class="org-variable-name">selection</span> <span class="org-operator">=</span> np.where<span class="org-rainbow-delimiters-depth-1">(</span>mask, image_t_0_channel_1, 0<span class="org-rainbow-delimiters-depth-1">)</span>

fig, <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-variable-name">ax0</span>, <span class="org-variable-name">ax1</span><span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-operator">=</span> plt.subplots<span class="org-rainbow-delimiters-depth-1">(</span>1, 2, figsize<span class="org-operator">=</span><span class="org-rainbow-delimiters-depth-2">(</span>12, 6<span class="org-rainbow-delimiters-depth-2">)</span>, sharey<span class="org-operator">=</span><span class="org-constant">True</span><span class="org-rainbow-delimiters-depth-1">)</span>

ax0.imshow<span class="org-rainbow-delimiters-depth-1">(</span>image_t_0_channel_1<span class="org-rainbow-delimiters-depth-1">)</span>
ax0.set_title<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'Second channel (raw)'</span><span class="org-rainbow-delimiters-depth-1">)</span>
ax0.set_axis_off<span class="org-rainbow-delimiters-depth-1">()</span>

ax1.imshow<span class="org-rainbow-delimiters-depth-1">(</span>selection<span class="org-rainbow-delimiters-depth-1">)</span>
ax1.set_title<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">'Selection'</span><span class="org-rainbow-delimiters-depth-1">)</span>
ax1.set_axis_off<span class="org-rainbow-delimiters-depth-1">()</span>

fig.tight_layout<span class="org-rainbow-delimiters-depth-1">()</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Daniel McGuiness</p>
</div>
</body>
</html>
